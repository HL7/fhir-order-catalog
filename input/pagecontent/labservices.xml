<div xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://hl7.org/fhir ../../input-cache/schemas-r5/fhir-single.xsd">
  <p>This page provides the detailed specifications for catalogs of laboratory diagnostic
    services.</p>
  <a name="LabServicesResourcesProfiles"> </a>
  <h3>Resources and Profiles</h3>
  <p> The figure below shows the resources and profiles used to represent catalogs of laboratory
    diagnostic services </p>
  <img src="LabCompendium.png" alt="Resources used by a laboratory service compendium" width="700px"/>
  <p>Catalogs of laboratory services use exclusively the <a
      href="StructureDefinition-CatalogHeader.html"> CatalogHeader profile </a> for the resource
    Composition. In other words, for binding a laboratory catalog to its items, only method 2 is
    usable, as depicted in <a href="index.html#technical"> Home Page - Technical overview</a> .
    Thus, the Composition resource holds only the general properties of the catalog and is
    referenced by the resources PlanDefinition constrained by the <a
      href="StructureDefinition-LabServiceDefinition.html"> LabServiceDefinition</a> profile, which
    represent the items of the catalog. </p>
  <p>An item of the catalog is a laboratory service instantiated as a PlanDefinition, which
    represents either a test (type=test) or a panel (type=panel). A panel is a set of tests and/or
    panels. This PlanDefinition conveys the general properties of the item: identification, names
    and codings, orderability, applicability, jurisdictions, billing, status, possible replacement
    by another item, gender or species restrictions, goals, bibliographic references, citations and
    justifications, expected input documents (such as patient consent for genetic testing). The
    PlanDefinition contains a single occurrence of the element PlanDefinition.action. </p>
  <p>PlanDefinition.action element references one or more instances of ActivityDefinition
    constrained by the <a href="StructureDefinition-LabProcedureDefinition.html"
      >LabProcedureDefinition profile, </a> each of which represents a laboratory procedure with its
    operational details, specifying in particular the specimens required to perform the test or
    panel, the input observations expected by the laboratory from the orderer, and the output
    observations that the procedure will produce.</p>
  <p>In most cases the PlanDefinition references a single ActivityDefinition, which represents the
    operational view of the service.</p>
  <p>In some cases the PlanDefinition of a lab service references multiple instances of
    ActivityDefinition representing multiple procedures assembled in logical groups with
    combinations of AND and OR. These logical combinations are used for example to indicate that the
    laboratory accepts multiple alternative specimens (e.g. venous blood versus capillary blood) to
    perform a test. They also allow to reuse existing panels within encompassing panels (e.g. LOINC
    49660-4 - HIV susceptibility panel by Genotype method, nesting 3 levels of panels and tests)</p>
  <p>Input and output observations of the service are defined as instances of ObservationDefinition
    (using the <a href="StructureDefinition-InputObservationDefinition.html"
      >InputObservationDefinition profile</a> for observations expected from the ordering clinician,
    and using the <a href="StructureDefinition-LabObservationDefinition.html">
      LabObservationDefinition profile</a> for observations produced by the lab service and reported
    back to the clinician), with their quantitative (units, decimal precision, conversion factor,
    normal and therapeutic ranges) and/or qualitative (authorized values, normal values, critical
    values, preferred report name) characteristics.</p>
  <p>Specimens required by the service are defined as instances of SpecimenDefinition conformant to
    the <a href="StructureDefinition-LabSpecimenDefinition.html">LabSpecimenDefinition profile</a>,
    which enables to describe patient preparation requirements, collection procedures, types of
    containers to be used, minimum volume needed, rejection criteria, retention time, handling
    requirements before testing. An instance of SpecimenDefinition may specify one preferred
    testable specimen and multiple alternates, each with its proper physical characteristics,
    handlings, requirements and rejection criteria. </p>
  <p>A laboratory service may provide more or less details about its billing. It may provide a
    textual billing summary as part of the PlanDefinition instance. It may also list the billing
    codes of a billing nomenclature, attached to it, still within the PlanDefinition instance. In
    addition, the service may specify for each billing code attached to it, what are the specific
    clinical focus that apply to this code, and what are its price components.</p>
  <a name="LabServicesSearchRetrieve"> </a>
  <h3>Searching and retrieving Laboratory Services</h3>
  <a name="LabServicesSearchApproach"> </a>
  <h4>Searching Approaches</h4>
  <p> The key searcheable assets in a laboratory compendium are the laboratory services exposed to
    the consumers of the compendium. Each laboratory service is represented by an instance of the <a
      href="http://hl7.org/fhir/plandefinition.html">PlanDefinition</a> resource, constrained by the
      <a href="StructureDefinition-LabServiceDefinition.html">LabServiceDefinition</a> profile. </p>
  <ul>
    <li><b>Two-step search</b>: A client application browsing the content of the compendium may wish
      to first get the overview of a collection of services at first glance, and then retrieve the
      full details associated with the services it is interested in (including specimens, input
      observations, lab results). In this case, the first query will perform a simple search on
        <i>PlanDefinition</i> with the desirable criteria listed in the table below ; and then the
      second search will add the <b><code>_include:iterate=*</code></b> parameter, to retrieve the
      PlanDefiniton resource(s) associated with all supporting resources (ActivityDefinition,
      ChargeItemDefinition, Composition, SpecimenDEfinition, ObservationDefinition ...) in the
        <i>searchset Bundle</i>.</li>
    <li><b>One-step search</b>: Conversely a client application may wish to retrieve the full
      details of a service (or a set of services) at first glance. In this case, it uses the
      appropriate search criteria for PlanDefinition, in combination with the
          <b><code>_include:iterate=*</code></b> parameter, so as to obtain all the resources
      supporting each laboratory service which satisfies the criteria, assembled in the <i>searchset
        Bundle</i>.</li>
  </ul>
  <p>Catalog servers may limit the iteration depth to an appropriate level for performance sake.</p>
  <a name="LabServicesSearchParameters"> </a>
  <h4>Search Parameters for Laboratory Services (PlanDefinition)</h4>
  <table border="1">
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Expression</th>
        <th>Role</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>catalog</td>
        <td>reference</td>
        <td>The reference to a Composition resource (profiled by CatalogHeader) owning this
          item</td>
        <td>PlanDefinition.extension.where(url='http://hl7.org/fhir/uv/order-catalog/StructureDefinition/CatalogReference').valueReference.reference(Composition)</td>
        <td>services of one catalog</td>
      </tr>
      <tr>
        <td>billingCode</td>
        <td>token</td>
        <td> A billing code associated with the service</td>
        <td>PlanDefinition.extension.where(url='http://hl7.org/fhir/uv/order-catalog/StructureDefinition/ServiceBillingCode').(value
          as Reference).reference(ChargeItemDefinition).resolve().code</td>
        <td>The FHIRPath expression to be checked</td>
      </tr>
      <tr>
        <td>orderable</td>
        <td>token</td>
        <td>(true: service with a useContext belonging to slice Orderable of LabServiceDefinition
          profile ; false: the opposite</td>
        <td>PlanDefinition.useContext.slice(http://hl7.org/fhir/uv/order-catalog/StructureDefinition/LabServiceDefinition,
          Orderable).exists()</td>
        <td>FHIRPath expression to be checked</td>
      </tr>
      <tr>
        <td>task</td>
        <td>token</td>
        <td>Service with a useContext representing a particular task (e.g. LABOE for orderable
          service, LABRREV for service that can be added by the pathologist)</td>
        <td>(PlanDefinition.useContext.where(code='task').value as CodeableConcept)</td>
        <td>services associated with the particular task</td>
      </tr>
      <tr>
        <td>gender</td>
        <td>token</td>
        <td>Services with a useContext representing a particular gender</td>
        <td>(PlanDefinition.useContext.where(code='gender').value as CodeableConcept)</td>
        <td>services restricted to a particular gender</td>
      </tr>
      <tr>
        <td>_lastUpdated</td>
        <td>date</td>
        <td>Last system point in time of PlanDefinition resource</td>
        <td/>
        <td>can be used with =gt...</td>
      </tr>
      <tr>
        <td>date</td>
        <td>date</td>
        <td>Publication date of service's business version</td>
        <td>PlanDefinition.date</td>
        <td>can be used with =gt...</td>
      </tr>
      <tr>
        <td>last-review-date</td>
        <td>date</td>
        <td>Last review date of the service</td>
        <td>PlanDefinition.lastReviewDate</td>
        <td>can be used with =gt...</td>
      </tr>
      <tr>
        <td>topic</td>
        <td>token</td>
        <td>topic associated with the service</td>
        <td>PlanDefinition.topic</td>
        <td>various categorizations of the service</td>
      </tr>
      <tr>
        <td>title</td>
        <td>string</td>
        <td>The service title</td>
        <td>PlanDefinition.title</td>
        <td/>
      </tr>
      <tr>
        <td>name</td>
        <td>string</td>
        <td>The service computational name</td>
        <td>PlanDefinition.name</td>
        <td/>
      </tr>
      <tr>
        <td>action-code</td>
        <td>token</td>
        <td>service code</td>
        <td>PlanDefinition.action.code</td>
        <td>LOINC code or local code of the service</td>
      </tr>
      <tr>
        <td>service-type</td>
        <td>token</td>
        <td>lab service type </td>
        <td>PlanDefinition.type</td>
        <td>narrow to type panel or type test</td>
      </tr>
      <tr>
        <td>status</td>
        <td>token</td>
        <td>lab service status </td>
        <td>PlanDefinition.status</td>
        <td>narrow to active or retired services</td>
      </tr>
      <tr>
        <td>publisher</td>
        <td>string</td>
        <td>lab service publisher </td>
        <td>PlanDefinition.publisher</td>
        <td/>
      </tr>
      <tr>
        <td>jurisdiction</td>
        <td>string</td>
        <td>lab service jurisdiction </td>
        <td>PlanDefinition.publisher</td>
        <td>e.g. country where service is usable</td>
      </tr>
    </tbody>
  </table>
  <a name="LabServicesSearchExamples"> </a>
  <h4>Examples of searching and retrieving laboratory services</h4>
  <p>In all examples below, [base] represents the endpoint of the catalog server. </p>
  <p>The answer of the server comes as a Bundle of type 'searchset' encapsulating the resources
    selected by the search.</p>
  <p>There is one particular laboratory service catalog, which has Composition.id "a1" on the
    server.</p>
  <a name="LabServicesAllCatalogs"> </a>
  <h5>List all catalogs of the server</h5>
  <pre>GET [base]/Composition?type:text=Catalog&amp;_summary=true</pre>
  <p> Obtains the summary of every catalog available on the server.The anwser Bundle contains one
    entry with a Composition resource for each catalog found.</p>
  <a name="LabServicesAvailableCatalogs"> </a>
  <h5>List available laboratory service catalogs</h5>
  <pre>GET [base]/Composition?type:text=Catalog&amp;_category=laboratory&amp;_summary=true</pre>
  <p> Obtains the summary of every laboratory service catalog available on the server. The anwser
    Bundle contains one entry with a Composition resource for each laboratory service catalog
    found.</p>
  <a name="LabServicesOfOneTopicWithinOneCatalog"> </a>
  <h5>List recently updated blood chemistry tests and panels of one catalog</h5>
  <pre>GET [base]/PlanDefinition?&amp;catalog=Composition/a1&amp;topic=http://snomed.info/sct|166312007&amp;date=gt20200323T10:00:00Z+0100&amp;_summary=true</pre>
  <p> Obtains the summary of the laboratory services from catalog of id a1, which are indexed by
    blood chemistry topic (coded in this example with SNOMED CT 166312007 |Blood chemistry|
    concept). The anwser Bundle contains one entry with a PlanDefinition resource for each
    laboratory service of catalog a1 associated with blood chemistry topic, and created or updated
    since March 23rd 10am.</p>
  <a name="LabServicesOfOneTopicWithinOneCatalog"> </a>
  <h5>Retrieve all details for a laboratory service</h5>
  <pre>GET [base]/PlanDefinition/s123?_include:iterate=*</pre>
  <p> Obtains the full content of PlanDefinition of id s123, accompanied with all resources
    referenced by this PlanDefinition: {Composition, ActivityDefinition, ObservationDefinition,
    SpecimenDefinition}. The anwser Bundle contains one entry with PlanDefinition resource s123, and
    below it, as many entries as resources referenced by this one (recursively). Thus the Bundle
    provides the fullly detailed description of this laboratory service. </p>
  <a name="LabServicesAdmin"> </a>
  <h3>Administering laboratory services</h3>
  <p>to do</p>
</div>
